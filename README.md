# Coach Artie Discord Bot

Hello and welcome to the repository of Coach Artie, the hyper-intelligent AI assistant for the [Room 302 Studio](https://www.room302.studio/). This repository specifically contains the code for the integration of Coach Artie with Discord.

## About Coach Artie

Coach Artie is an advanced AI assistant that facilitates collaboration, helps answer questions, and sources resources to support the members of Room 302 Studio - a creative space dedicated to cultivating innovative projects and ideas. Created by EJ, Ian and Curran of Room 302 with a deep care for the emotional state of the studio members, Coach Artie's goal is promoting a growth-conscious and explorative learning environment. 

## Features

1. **Information Storage:** Coach Artie can remember key details from past interactions, providing a personalized support experience.
2. **Versatile Capabilities:** from fetching URL summaries, integrating with Google Drive, to generating pytorch-friendly code snippets, Coach Artie showcases a wide array of skills.
3. **Ease of Communication:** by joining your Discord server, Coach Artie can seamlessly engage with the studio members in real-time.

## Code Overview

The codebase is primarily divided into three main files: `discord.js`, `capabilities.js`, and `chain.js`.

## Discord Interface

`discord.js` is responsible for setting up the Discord bot client, handling message creation events, and sending messages or embed messages to the Discord server. It also includes functions to detect if the bot was mentioned or if the channel name includes a bot.

## Capabilities

`capabilities.js` contains the definitions of the bot's capabilities. It includes a regex for identifying capability calls, a function for calling capability methods, and a prompt for informing the bot about its capabilities.

`_manifest.js` is a manifest of all of the capabilities that are available. It is automatically generated from the JSDoc comments in the capability files

`chain.js` is responsible for processing message chains. It includes functions for processing messages, processing capabilities, and getting capability responses. It also handles token limits and generates AI responses based on the result of the capability processing.

`capabilities/_generate-manifest.js` generates the `capabilities/_manifest.json` file, which contains the list of capabilities that the bot can perform. For each capability file, it uses the inline JSDoc comments to understand the methods and parameters avilable.

```js
// capability name
"calculator": [
    {
      // method name
      "name": "calculator:add()",

      // instructions on how to use the method and what it returns
      "description": "Adds up an array of numbers. Returns: The sum of the numbers.",

      // parameter information
      "parameters": [
        {
          "name": "numbers",
          "description": "The array of numbers to be added."
        }
      ]
    },
  ]
```


## Database Overview

### Messages Table

```sql
CREATE EXTENSION vector;

create table
  public.messages (
    id bigint generated by default as identity,
    embedding vector(1536) null,
    created_at timestamp with time zone null default now(),
    key text null,
    value text null,
    user_id text null,
    channel_id text null,  -- field to store the channel ID
    guild_id text null,    -- field to store the guild ID
    response_id bigint null,  -- field to reference the ID of the robot's response
    constraint messages_pkey primary key (id)
  ) tablespace pg_default;
```

### Memories Table
```sql
create table
  public.memories (
    id bigint generated by default as identity,
    embedding vector(1536) null,
    created_at timestamp with time zone null default now(),
    key text null,
    value text null,
    user_id text null,
    related_message_id bigint null,  -- field to reference the ID of the related message
    constraint memories_pkey primary key (id)
  ) tablespace pg_default;

```

### Matching Query
  
```sql
create or replace function match_memories (
  query_embedding public.vector(1536),
  match_threshold float,
  match_count int
)
returns table (
  id bigint,
  key text,
  value text,
  user_id text,
  related_message_id bigint,
  similarity float
)
language sql stable
as $$
select
  memories.id,
  memories.key,
  memories.value,
  memories.user_id,
  memories.related_message_id,
  1 - (memories.embedding <=> query_embedding) as similarity
from memories
where 1 - (memories.embedding <=> query_embedding) > match_threshold
order by similarity desc
limit match_count;
$$;
```

## Acquiring API Keys and Tokens

### Discord
- **DISCORD_PUBLIC_KEY**: Visit the [Discord Developer Portal](https://discord.com/developers/applications), create a new application, and find your Public Key under the 'General Information' tab.
- **DISCORD_APP_ID**: This is the 'Client ID' found in the same section as above in the Discord Developer Portal.
- **DISCORD_BOT_TOKEN**: In the Discord Developer Portal, navigate to 'Bot', create a new bot, and use the token provided here.
- **DISCORD_VOICE_CHANNEL_ID** and **DISCORD_GUILD_ID**: These IDs can be obtained by enabling 'Developer Mode' in Discord settings, right-clicking on the channel/guild, and selecting 'Copy ID'.

### OpenAI
- **OPENAI_API_KEY**: Sign up at [OpenAI](https://beta.openai.com/signup/), and after verification, you can access your API key in your account settings.
- **OPENAI_API_ORGANIZATION**: This is your organization ID on OpenAI, available in your account settings on the OpenAI dashboard.

### GitHub
- **GITHUB_USER**: The bot's github username.
- **GITHUB_TOKEN**, **GITHUB_APP_ID**, **GITHUB_INSTALLATION_ID**, **GITHUB_PERSONAL_ACCESS_TOKEN**: Generate these tokens by going to your GitHub settings, selecting 'Developer settings' â†’ 'Personal access tokens', and creating a new token with the appropriate scopes.
- **GITHUB_PERSONAL_ACCESS_TOKEN**: (Duplicate entry, see above)

### Wolfram Alpha
- **WOLFRAM_APP_ID**: Sign up at [Wolfram Alpha Developer Portal](https://developer.wolframalpha.com/portal/myapps/), create an application, and use the AppID provided.

### ElevenLabs
- **ELEVENLABS_VOICE_ID** and **ELEVEN_LABS_API_KEY**: Register at [ElevenLabs](https://www.elevenlabs.io/), create an application, and find your API Key and Voice ID under your application settings.

### Google
- **GOOGLE_CLIENT_ID** and **GOOGLE_SECRET**: Go to the [Google Cloud Console](https://console.cloud.google.com/), create a new project, and navigate to 'APIs & Services' > 'Credentials'. Here, you can create your OAuth 2.0 credentials. You will need to create a service account and download the JSON file containing your credentials. You will also need to enable the Google Drive, Calendar, and Docs APIs for your project.

### Mastodon
- **MASTODON_API_URL** and **MASTODON_ACCESS_TOKEN**: Register your application with your Mastodon instance to receive the API URL, then follow the authentication process to obtain your access token.